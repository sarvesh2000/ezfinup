<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <!-- CSS Link -->
    <link rel="stylesheet" href="{{ url_for('static',filename='styles/dashboard2-style.css') }}">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
        integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w=="
        crossorigin="anonymous" />

    <title>EZFINUP - Dashboard</title>
</head>

<body>
    <div class="navbar navbar-light bg-light">
        <div class="container">

        </div>
    </div>

    <!-- left search bar of the page -->
    <div class="container">
        <div class="row">
            <div class="left">
                <input type="text" id="mySearch" onkeyup="myfunction()" placeholder="Search eg: YESBANK, IDEA">
                <ul id="myMenu">
                    <li><a href="#">NIFTY 50</a></li>
                    <li><a href="#">SENSEX</a></li>
                    <li><a href="#">YESBANK</a></li>
                    <li><a href="#" onclick="getIdea()">IDEA</a></li>
                    <li><a href="#">AAPL</a></li>
                </ul>
            </div>


            <!-- Right side main content -->
            <div class="right">
                <h2>Prediction Graph</h2>
                <div class="container" id="graph">
                HI
                </div>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
    -->
    <!--  jQuery  -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!--  Stock Chart  -->
    <script src="{{ url_for('static',filename='JS/jquery.canvasjs.stock.min.js') }}"></script>
    <!--  Custom Script to call and get Prediction from Cloud  -->
    <script>
        function showGraph(data){
          var dataPoints = [];
          var stockChart = new CanvasJS.StockChart("graph", {
            exportEnabled: true,
            title: {
              text:"StockChart with Line using JSON Data"
            },
            subtitles: [{
              text:"Total Retail Sales of ACME "
            }],
            charts: [{
              axisX: {
                crosshair: {
                  enabled: true,
                  snapToDataPoint: true,
                  valueFormatString: "##"
                }
              },
              axisY: {
                title: "INR",
                prefix: "₹",
                crosshair: {
                  enabled: true,
                  snapToDataPoint: true,
                  valueFormatString: "₹#,###.00",
                }
              },
              data: [{
                type: "line",
                xValueFormatString: "##",
                yValueFormatString: "₹#,###.##",
                dataPoints : dataPoints
              }]
            }],
            navigator: {
              // slider: {
              //   minimum: new Date(2010, 00, 01),
              //   maximum: new Date(2018, 00, 01)
              // }
              enabled:false
            }
          });
          // $.getJSON("https://canvasjs.com/data/gallery/stock-chart/grocery-sales.json", function(data) {
          //   for(var i = 0; i < data.length; i++){
          //     dataPoints.push({x: new Date(data[i].date), y: Number(data[i].sale)});
          //   }
          //   stockChart.render();
          // });
          var dat = data["data"];
          console.log("DAT ",dat);
          for(var i = 0; i < dat[0]["x"].length; i++){
            for(var j = 0; j < dat[1]["x"][i].length; j++){
              dataPoints.push({x: dat[0]["x"][i], y: dat[1]["x"][i][j]});
            }
            console.log("Datapoints",dataPoints);
          }
          for(var i = 0; i < dat[0]["y"].length; i++){
            for(var j = 0; j < dat[1]["y"][i].length; j++){
              dataPoints.push({x: dat[0]["y"][i], y: dat[1]["y"][i][j]});
            }
            console.log("Datapoints",dataPoints);
          }
          stockChart.render();
        }
        function getIdea(){
            console.log("Clicked IDEA");
            $.ajax({url: "http://35.232.169.155/?stockname=IDEA.NS",
                    success: function(result){
                                // $("#graph").html(result);
                                showGraph(result);
                    },
                    fail: function(error){
                            console.log("Error:",error);
                    }
            });
        }
    </script>
</body>

</html>